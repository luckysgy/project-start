#! /bin/bash

if [ ! -d "${ed.db.dataRootPath}/log" ]; then
  mkdir -p ${ed.db.dataRootPath}/log
  chmod 777 ${ed.db.dataRootPath}/log
fi

if [ ! -d "${ed.db.dataRootPath}/data" ]; then
  mkdir -p ${ed.db.dataRootPath}/data
  chmod 777 ${ed.db.dataRootPath}}/data
fi

docker stop mysql-server
docker rm mysql-server

docker run -d  \
--restart=always \
--name mysql-server \
-p ${ed.db.port.node}:${ed.db.port.container} \
-v ${ed.db.dataRootPath}/logs:/var/log/mysql/ \
-v ${ed.db.dataRootPath}/data:/var/lib/mysql/ \
-e "TZ=Asia/Shanghai" \
-e "MYSQL_ROOT_PASSWORD=${ed.db.password}"            \
${ed.db.image} \
--default-authentication-plugin=mysql_native_password \
--character-set-server=utf8mb4 \
--collation-server=utf8mb4_general_ci \
--explicit_defaults_for_timestamp=true \
--lower_case_table_names=1 \
--max_allowed_packet=128M
echo "start mysql"
